<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        * {
            padding: 0;
            margin: 0;
            text-decoration: none;
            list-style: none;
            font-family: Arial, Helvetica, sans-serif;
        }

        .frame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #fff;
            color: #fff;
        }

        .stage {
            position: absolute;
            min-width: 100vw;
            min-height: 100vh;
            top: 0;
            left: 0;
            background: linear-gradient(#000130, #3946cf);
            overflow: hidden;
            opacity: .8;

        }

        .star {
            width: 1px;
            height: 1px;
            background-color: #fff;
            position: absolute;
        }

        .StarWithMouse {
            width: 1px;
            height: 1px;
            background-color: #fff;
            position: absolute;
        }

        @keyframes flickr {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.2;
            }
        }

        .shooting-star {
            position: absolute;
            left: 10px;
            width: 100px;
            height: 1px;
            border-radius: 0 50% 50% 0;
            background: linear-gradient(to left, rgba(255, 255, 255, .6), rgba(255, 255, 255, .0));
            z-index: 999;
        }

        @keyframes shooting-star {
            0% {
                opacity: 1;
                transform: translate3d(0, 0, 0) rotate(25deg);
            }

            10%,
            100% {
                opacity: 0;
                transform: translate3d(851px, 364px, 0) rotate(25deg);
            }
        }

        .Copyright {
            position: absolute;
            left: -80px;
            width: 325px;
            height: 68px;
            text-align: center;
            background-color: rgba(48, 48, 189, 0.4);
            transform: rotate(-45deg);
        }

        .Copyright>p {
            padding: 5px;
            color: aliceblue;
            font-size: 1rem;
            font-weight: 600;
        }

        .wheel {
            width: 50vw;
            height: 50vh;
            margin: 5vh 10vw;
            position: relative;
        }

        .pattern {
            color: #fff;
            width: 50%;
            height: 50%;
            position: relative;
        }

        .fan {
            width: 550px;
            height: 550px;
            border-radius: 50%;
            clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%);
            position: absolute;
            top: 0;
            overflow: hidden;
            left: 0;
        }

        .inner {
            width: 50%;
            height: 100%;
            transform: rotate(60deg);
        }

        .inner_style {
            transform: inherit;
            display: flex;
            justify-content: center;
        }

        .fa-solid {
            font-size: 50px;
            position: absolute;
            top: 250px;
            left: 250px;
            z-index: 1;
            transform: rotate(360deg);
            transition: all 2s;
        }

        h3 {
            transform: rotate(5deg);
        }

        .text {
            color: #fff;
            max-width: 30vw;
            max-height: 20vh;
            position: absolute;
            top: 20vh;
            right: 15vw;
        }

        .IP {
            font-size: 1.5rem;
        }

        footer div {
            width: 98%;
            display: flex;
            justify-content: center;
            position: absolute;
            bottom: 2px;
            left: 1%;
            right: 1%;
            color: #fff;
            overflow: hidden;
        }

        @media screen and (max-width:1000px) {
            .fan {
                width: 500px;
                height: 500px;
                border-radius: 50%;
                clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%);
                position: absolute;
                top: 0;
                overflow: hidden;
                left: 0;
            }

            .fa-solid {
                font-size: 50px;
                position: absolute;
                top: 225px;
                left: 228px;
                z-index: 1;
                transform: rotate(360deg);
                transition: all 2s;
            }

            h3 {
                font-size: 1.0rem;
            }

            .text {
                max-width: 100vw;
                max-height: 100%;
                position: absolute;
                top: 70vh;
                left: 5vw;
            }
        }

        @media screen and (max-width:480px) {
            .fan {
                width: 280px;
                height: 280px;
                border-radius: 50%;
                clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%);
                position: absolute;
                top: 0;
                overflow: hidden;
                left: 0;
            }

            .fa-solid {
                font-size: 30px;
                position: absolute;
                top: 120px;
                left: 120px;
                z-index: 1;
                transform: rotate(360deg);
                transition: all 2s;
            }
            h3{
                font-size: 0.9rem;
            }

            .text {
                max-width: 100vw;
                max-height: 30vh;
                position: absolute;
                top: 50vh;
                left: 8vw;
            }
        }
    </style>
</head>

<body>

    <div class="frame">
        <div class="stage"></div>
    </div>
    <div class="Copyright">
        <p class="layer" data-speed="2">
            &copy; <br>Copyright 2022 <a href="http://ntc.im/" target="_blank" style="color:rgb(0, 0, 255)">
                NTC.im.</a>
            <br> All rights
            reserved.
        </p>
    </div>
    <div class="wheel">
        <div class="pattern layer">
            <i class="fa-solid fa-location-arrow" data-speed="3"></i>
        </div>
    </div>
    <div class="text layer" data-speed="-4"></div>
    <footer>
        <div>
            <p class="layer" data-speed="3">
                Design by Smile⁽⁽٩(๑˃̶͈̀ ᗨ ˂̶͈́)۶⁾⁾<a href="https://github.com/s930175" target="_blank">My
                    Github</a>
            </p>

        </div>
    </footer>


    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script>
        $(function () {
            let data = [];
            let giftbox = [];
            let IP;
            $.ajax({
                url: "https://api.ipify.org?format=json",
                method: "GET",
                dataType: "JSON",
                success: function (res) {
                    IP = res
                    // console.log(IP)
                }
            })
            function getData() {
                $.get('./db.json', function (res) {
                    // console.log(res)
                    data = res;
                    let preAngle = 360 / res.length;
                    $.each(res, function (index, item) {
                        // console.log(item.num)
                        let fan = $(`<div class='fan'></div>`)
                        let inner = $(`
                        <div class='inner'>
                            <div class="inner_style" style="transform:rotate(-${preAngle * index}deg);">
                                <h3>${item.title}</h3>
                            </div>
                        </div>`)
                        fan.css('transform', `rotate(${preAngle * index - 66}deg)`)
                        // inner.css('transform', `rotate(${preAngle}deg)`)
                        let piece = fan.append(inner);
                        $('.pattern').append(piece)
                        // 設置機率(來不及做)
                        for (let i = 0; i < item.num; i++) {
                            giftbox.push(index)
                        }
                    })
                    // 處理機率(來不及做)
                    let shuffle = function () {
                        let num = Math.random() > 0.5 ? -1 : 1
                        return num
                    }
                    // 處理機率陣列，把giftbox陣列裡的數字打亂(還是來不及做)
                    let gift = giftbox.sort(shuffle).pop()
                    // console.log(gift)
                    // console.log(giftbox)
                    // 愛的魔力轉圈圈
                    // $('.fa-solid').on('click', function (){
                    //     let starAngle = 0;
                    //     let goAngle = starAngle + gift*preAngle+360*5


                    // })
                    $(document).on('click', function () {
                        let randomNum = Math.floor(Math.random() * 360)
                        $('.fa-solid').css('transform', `rotate(${randomNum * 8 - 54}deg)`)
                        // 文字顯示時間及對應的角度
                        setTimeout(function () {
                            if (randomNum * 8 % 360 <= preAngle) return $('.text').text(res[1].text).css('font-size', '1.1rem')
                            else if (randomNum * 8 % 360 <= preAngle * 2 && randomNum * 8 % 360 >= preAngle) $('.text').text(IP.ip).css('font-size', '3rem')
                            else if (randomNum * 8 % 360 <= preAngle * 3 && randomNum * 8 % 360 >= preAngle * 2) $('.text').text(res[3].text).css('font-size', '1.1rem')
                            else if (randomNum * 8 % 360 <= preAngle * 4 && randomNum * 8 % 360 >= preAngle * 3) $('.text').text(IP.ip).css('font-size', '3rem')
                            else if (randomNum * 8 % 360 <= preAngle * 5 && randomNum * 8 % 360 >= preAngle * 4) $('.text').text(res[5].text).css('font-size', '1.1rem')
                            else $('.text').text(IP.ip).css('font-size', '3rem')
                        }, 2000)
                    })
                })

            }
            getData()

            // 星星閃爍動畫
            let stage = document.querySelector('.stage');
            let strStar = '';
            // 創建星星div
            for (let i = 0; i < 200; i++) {
                strStar += `<div class="star" style="left:${Math.floor(Math.random() * 100)}vw;top:${Math.floor(Math.random() * 100)}vh;animation: ${2 + Math.floor(Math.random() * 2)}s flickr -${0 + Math.floor(Math.random() * 3)}s infinite;"></div>`;
            }
            // 流星div
            for (let i = 0; i < 10; i++) {
                strStar += `<div class="shooting-star" style="top:${Math.round(Math.random() * 100 + 50)}px;animation:${Math.round(Math.random() * 5 + 20)}s shooting-star -${Math.round(Math.random() * 250 / 10)}s infinite;"></div>`;
            }


            // 創建跟隨滑鼠的星星(物件導向 不會ㄏ)
            // class StarWithMouse {
            //     constructor(){
            //         this.x = 0;
            //         this.y = 0;
            //     }
            // };
            let StarWithMouse = '';
            // 儲存座標的陣列
            let originalLeft = [];
            let originalTop = [];
            const numStar = 450;
            for (let i = 0; i < numStar; i++) {
                let numberX = Math.floor(Math.random() * 1400)
                let numberY = Math.floor(Math.random() * 800)
                originalLeft.push(numberX)
                originalTop.push(numberY)
            }
            // 創建隨滑鼠移動的小星星
            for (let i = 0; i < numStar; i++) {
                StarWithMouse += `<div class="StarWithMouse" index="${i}" style="left:${originalLeft[i]}px;top:${originalTop[i]}px;animation: ${2 + Math.floor(Math.random() * 2)}s flickr -${0 + Math.floor(Math.random() * 3)}s infinite;transition:all .5s;"></div>`;
                // 一開始先隨機生成位置
                // $('.StarWithMouse').attr('index',i).css('left', `${Math.floor(Math.random() * 100)}vw`);
                // $('.StarWithMouse').attr('index',i).css('top', `${Math.floor(Math.random() * 100)}vh`);
                // 滑鼠移動時靠近
            }
            document.addEventListener('mousemove', function (event) {
                // 背景偏移
                // let movementStrength = 25;
                // let backgroundHeight = movementStrength / $(window).height();
                // let backgroundWidth = movementStrength / $(window).width();
                // let backgroundY = event.pageY - ($(window).height() / 2);
                // let backgroundX = event.pageX - ($(window).width() / 2);
                // let newvalueX = backgroundWidth * backgroundX * -1 - 25;
                // let newvalueY = backgroundHeight * backgroundY * -1 - 50;
                // $('.frame').css("background-position", `${newvalueX}px,${newvalueY}px`)
                // 元素偏移
                this.querySelectorAll('.layer').forEach(layer => {
                    const speed = layer.getAttribute('data-speed');
                    const x = (window.innerWidth - event.pageX * speed) / 500
                    const y = (window.innerHeight - event.pageY * speed) / 500
                    layer.style.transform = `translateX(${x}px) translateY(${y}px)`
                })
                // 背景星星移動
                let StarWithMouseALL = document.querySelectorAll('.StarWithMouse')
                let x = event.pageX;
                let y = event.pageY;
                for (let i = 0; i < StarWithMouseALL.length; i++) {
                    // let StarLeftWithMouse =  StarWithMouseALL[i].style.left
                    // let StarTopWithMouse = StarWithMouseALL[i].style.top
                    // 去除px
                    // console.log(StarLeftWithMouse)
                    // StarWithMouseALL[i].style.left = parseInt(StarWithMouseALL[i].style.left.replace('px',''))
                    // StarWithMouseALL[i].style.top = parseInt(StarWithMouseALL[i].style.top.replace('px',''))
                    // console.log(x-parseInt(StarWithMouseALL[i].style.left.replace('px','')))
                    if (Math.abs(x - parseInt(StarWithMouseALL[i].style.left.replace('px', ''))) < 50 && Math.abs(y - parseInt(StarWithMouseALL[i].style.top.replace('px', ''))) < 50) {
                        StarWithMouseALL[i].style.left = x - Math.floor(Math.random() * 50) + 'px';
                        StarWithMouseALL[i].style.top = y - Math.floor(Math.random() * 50) + 'px'
                    } else {
                        StarWithMouseALL[i].style.left = originalLeft[i] + 'px';
                        StarWithMouseALL[i].style.top = originalTop[i] + 'px';
                    }

                }

            })

            stage.innerHTML = strStar + StarWithMouse;

        })

    </script>
</body>

</html>
